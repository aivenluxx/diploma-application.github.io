{"ast":null,"code":"import React,{useState,useEffect,useRef}from'react';import'../../styles/MainPage/Speedometer.css';import{jsxs as _jsxs,jsx as _jsx}from\"react/jsx-runtime\";const Speedometer=()=>{const[speed,setSpeed]=useState(0);// в km/h\nconst[unit,setUnit]=useState('kph');const watchId=useRef(null);const prevPos=useRef(null);const getSpeedInUnit=()=>{switch(unit){case'mps':return(speed/3.6).toFixed(2);// km/h -> m/s\ncase'mph':return(speed*0.621371).toFixed(2);// km/h -> mph\ndefault:return speed.toFixed(2);}};const changeUnit=newUnit=>{setUnit(newUnit);};const calculateDistance=(lat1,lon1,lat2,lon2)=>{const toRad=val=>val*Math.PI/180;const R=6371000;// радиус Земли в метрах\nconst dLat=toRad(lat2-lat1);const dLon=toRad(lon2-lon1);const a=Math.sin(dLat/2)**2+Math.cos(toRad(lat1))*Math.cos(toRad(lat2))*Math.sin(dLon/2)**2;const c=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));return R*c;// в метрах\n};const startTracking=()=>{if(!navigator.geolocation){alert('Geolocation is not supported by your browser');return;}if(watchId.current!==null){navigator.geolocation.clearWatch(watchId.current);watchId.current=null;setSpeed(0);prevPos.current=null;return;}watchId.current=navigator.geolocation.watchPosition(position=>{const{latitude,longitude}=position.coords;const currentTime=position.timestamp;if(prevPos.current){const{latitude:prevLat,longitude:prevLon,time:prevTime}=prevPos.current;const dist=calculateDistance(prevLat,prevLon,latitude,longitude);// в метрах\nconst timeElapsed=(currentTime-prevTime)/1000;// в секундах\nif(timeElapsed>0){const speedMps=dist/timeElapsed;// скорость в м/с\nconst speedKph=speedMps*3.6;// скорость в км/ч\nsetSpeed(speedKph);}}prevPos.current={latitude,longitude,time:currentTime};},error=>{// Игнорируем таймауты, чтобы не показывать ошибку, если позиция не обновляется\nif(error.code===error.TIMEOUT){console.warn('Geolocation timeout - position did not change');return;}console.error('Error getting position:',error);alert('Ошибка получения геолокации');},{enableHighAccuracy:true,maximumAge:0,timeout:3000});};useEffect(()=>{return()=>{if(watchId.current!==null){navigator.geolocation.clearWatch(watchId.current);}};},[]);return/*#__PURE__*/_jsx(\"div\",{className:\"app-container\",children:/*#__PURE__*/_jsx(\"main\",{className:\"content\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"speedometer-section\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"speedometer-container\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"speedometer-unit-wrapper\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"speedometer-display\",children:/*#__PURE__*/_jsx(\"div\",{className:\"digital-speedometer\",children:/*#__PURE__*/_jsxs(\"p\",{children:[getSpeedInUnit(),\" \",unit]})})}),/*#__PURE__*/_jsxs(\"aside\",{className:\"unit-selector\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>changeUnit('mps'),children:\"m/s\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>changeUnit('mph'),children:\"mph\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>changeUnit('kph'),children:\"km/h\"})]})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"speed-controls\",children:/*#__PURE__*/_jsx(\"button\",{className:\"start-button\",onClick:startTracking,children:watchId.current===null?'Start':'Stop'})})]})})});};export default Speedometer;","map":{"version":3,"names":["React","useState","useEffect","useRef","jsxs","_jsxs","jsx","_jsx","Speedometer","speed","setSpeed","unit","setUnit","watchId","prevPos","getSpeedInUnit","toFixed","changeUnit","newUnit","calculateDistance","lat1","lon1","lat2","lon2","toRad","val","Math","PI","R","dLat","dLon","a","sin","cos","c","atan2","sqrt","startTracking","navigator","geolocation","alert","current","clearWatch","watchPosition","position","latitude","longitude","coords","currentTime","timestamp","prevLat","prevLon","time","prevTime","dist","timeElapsed","speedMps","speedKph","error","code","TIMEOUT","console","warn","enableHighAccuracy","maximumAge","timeout","className","children","onClick"],"sources":["C:/Users/User/Documents/GitHub/diploma-application/my-app/src/components/MainPage/Speedometer.jsx"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\r\nimport '../../styles/MainPage/Speedometer.css';\r\n\r\nconst Speedometer = () => {\r\n  const [speed, setSpeed] = useState(0); // в km/h\r\n  const [unit, setUnit] = useState('kph');\r\n  const watchId = useRef(null);\r\n  const prevPos = useRef(null);\r\n\r\n  const getSpeedInUnit = () => {\r\n    switch (unit) {\r\n      case 'mps':\r\n        return (speed / 3.6).toFixed(2); // km/h -> m/s\r\n      case 'mph':\r\n        return (speed * 0.621371).toFixed(2); // km/h -> mph\r\n      default:\r\n        return speed.toFixed(2);\r\n    }\r\n  };\r\n\r\n  const changeUnit = (newUnit) => {\r\n    setUnit(newUnit);\r\n  };\r\n\r\n  const calculateDistance = (lat1, lon1, lat2, lon2) => {\r\n    const toRad = (val) => (val * Math.PI) / 180;\r\n    const R = 6371000; // радиус Земли в метрах\r\n    const dLat = toRad(lat2 - lat1);\r\n    const dLon = toRad(lon2 - lon1);\r\n    const a =\r\n      Math.sin(dLat / 2) ** 2 +\r\n      Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) * Math.sin(dLon / 2) ** 2;\r\n    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\r\n    return R * c; // в метрах\r\n  };\r\n\r\n  const startTracking = () => {\r\n    if (!navigator.geolocation) {\r\n      alert('Geolocation is not supported by your browser');\r\n      return;\r\n    }\r\n\r\n    if (watchId.current !== null) {\r\n      navigator.geolocation.clearWatch(watchId.current);\r\n      watchId.current = null;\r\n      setSpeed(0);\r\n      prevPos.current = null;\r\n      return;\r\n    }\r\n\r\n    watchId.current = navigator.geolocation.watchPosition(\r\n      (position) => {\r\n        const { latitude, longitude } = position.coords;\r\n        const currentTime = position.timestamp;\r\n\r\n        if (prevPos.current) {\r\n          const { latitude: prevLat, longitude: prevLon, time: prevTime } = prevPos.current;\r\n\r\n          const dist = calculateDistance(prevLat, prevLon, latitude, longitude); // в метрах\r\n          const timeElapsed = (currentTime - prevTime) / 1000; // в секундах\r\n\r\n          if (timeElapsed > 0) {\r\n            const speedMps = dist / timeElapsed; // скорость в м/с\r\n            const speedKph = speedMps * 3.6; // скорость в км/ч\r\n            setSpeed(speedKph);\r\n          }\r\n        }\r\n\r\n        prevPos.current = { latitude, longitude, time: currentTime };\r\n      },\r\n      (error) => {\r\n        // Игнорируем таймауты, чтобы не показывать ошибку, если позиция не обновляется\r\n        if (error.code === error.TIMEOUT) {\r\n          console.warn('Geolocation timeout - position did not change');\r\n          return;\r\n        }\r\n        console.error('Error getting position:', error);\r\n        alert('Ошибка получения геолокации');\r\n      },\r\n      { enableHighAccuracy: true, maximumAge: 0, timeout: 3000 }\r\n    );\r\n  };\r\n\r\n  useEffect(() => {\r\n    return () => {\r\n      if (watchId.current !== null) {\r\n        navigator.geolocation.clearWatch(watchId.current);\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  return (\r\n    <div className=\"app-container\">\r\n      <main className=\"content\">\r\n        <div className=\"speedometer-section\">\r\n          <div className=\"speedometer-container\">\r\n            <div className=\"speedometer-unit-wrapper\">\r\n              <div className=\"speedometer-display\">\r\n                <div className=\"digital-speedometer\">\r\n                  <p>\r\n                    {getSpeedInUnit()} {unit}\r\n                  </p>\r\n                </div>\r\n              </div>\r\n              <aside className=\"unit-selector\">\r\n                <button onClick={() => changeUnit('mps')}>m/s</button>\r\n                <button onClick={() => changeUnit('mph')}>mph</button>\r\n                <button onClick={() => changeUnit('kph')}>km/h</button>\r\n              </aside>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"speed-controls\">\r\n            <button className=\"start-button\" onClick={startTracking}>\r\n              {watchId.current === null ? 'Start' : 'Stop'}\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </main>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Speedometer;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}