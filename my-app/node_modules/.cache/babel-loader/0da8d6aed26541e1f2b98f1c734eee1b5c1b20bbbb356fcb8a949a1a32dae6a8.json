{"ast":null,"code":"import React,{useState,useEffect,useRef}from'react';import'../../styles/MainPage/Speedometer.css';import{jsxs as _jsxs,jsx as _jsx}from\"react/jsx-runtime\";const Speedometer=()=>{const[speed,setSpeed]=useState(0);const[unit,setUnit]=useState('kph');const watchId=useRef(null);const prevPos=useRef(null);const audioRef=useRef(null);const speedLimit=60;const isAlertPlaying=useRef(false);const getSpeedInUnit=()=>{switch(unit){case'mps':return(speed/3.6).toFixed(2);// km/h -> m/s\ncase'mph':return(speed*0.621371).toFixed(2);// km/h -> mph\ndefault:return speed.toFixed(2);}};const changeUnit=newUnit=>{setUnit(newUnit);};const calculateDistance=(lat1,lon1,lat2,lon2)=>{const toRad=val=>val*Math.PI/180;const R=6371000;const dLat=toRad(lat2-lat1);const dLon=toRad(lon2-lon1);const a=Math.sin(dLat/2)**2+Math.cos(toRad(lat1))*Math.cos(toRad(lat2))*Math.sin(dLon/2)**2;const c=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));return R*c;};const startTracking=()=>{if(!navigator.geolocation){alert('Geolocation is not supported by your browser');return;}if(watchId.current!==null){navigator.geolocation.clearWatch(watchId.current);watchId.current=null;setSpeed(0);prevPos.current=null;stopAlert();return;}watchId.current=navigator.geolocation.watchPosition(position=>{const{latitude,longitude}=position.coords;const currentTime=position.timestamp;if(prevPos.current){const{latitude:prevLat,longitude:prevLon,time:prevTime}=prevPos.current;const dist=calculateDistance(prevLat,prevLon,latitude,longitude);const timeElapsed=(currentTime-prevTime)/1000;if(timeElapsed>0){const speedMps=dist/timeElapsed;const speedKph=speedMps*3.6;setSpeed(speedKph);if(speedKph>speedLimit){playAlert();}else{stopAlert();}}}prevPos.current={latitude,longitude,time:currentTime};},error=>{if(error.code===error.TIMEOUT){console.warn('Geolocation timeout - position did not change');return;}console.error('Error getting position:',error);alert('Ошибка получения геолокации');},{enableHighAccuracy:true,maximumAge:0,timeout:3000});};const playAlert=()=>{if(!isAlertPlaying.current&&audioRef.current){audioRef.current.play();isAlertPlaying.current=true;}};const stopAlert=()=>{if(isAlertPlaying.current&&audioRef.current){audioRef.current.pause();audioRef.current.currentTime=0;isAlertPlaying.current=false;}};useEffect(()=>{return()=>{if(watchId.current!==null){navigator.geolocation.clearWatch(watchId.current);}stopAlert();};},[]);return/*#__PURE__*/_jsx(\"div\",{className:\"app-container\",children:/*#__PURE__*/_jsx(\"main\",{className:\"content\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"speedometer-section\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"speedometer-container\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"speedometer-unit-wrapper\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"speedometer-display\",children:/*#__PURE__*/_jsx(\"div\",{className:\"digital-speedometer\",children:/*#__PURE__*/_jsxs(\"p\",{children:[getSpeedInUnit(),\" \",unit]})})}),/*#__PURE__*/_jsxs(\"aside\",{className:\"unit-selector\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>changeUnit('mps'),children:\"m/s\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>changeUnit('mph'),children:\"mph\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>changeUnit('kph'),children:\"km/h\"})]})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"speed-controls\",children:/*#__PURE__*/_jsx(\"button\",{className:\"start-button\",onClick:startTracking,children:watchId.current===null?'Start':'Stop'})}),/*#__PURE__*/_jsx(\"audio\",{ref:audioRef,src:\"https://actions.google.com/sounds/v1/alarms/beep_short.ogg\",preload:\"auto\"})]})})});};export default Speedometer;","map":{"version":3,"names":["React","useState","useEffect","useRef","jsxs","_jsxs","jsx","_jsx","Speedometer","speed","setSpeed","unit","setUnit","watchId","prevPos","audioRef","speedLimit","isAlertPlaying","getSpeedInUnit","toFixed","changeUnit","newUnit","calculateDistance","lat1","lon1","lat2","lon2","toRad","val","Math","PI","R","dLat","dLon","a","sin","cos","c","atan2","sqrt","startTracking","navigator","geolocation","alert","current","clearWatch","stopAlert","watchPosition","position","latitude","longitude","coords","currentTime","timestamp","prevLat","prevLon","time","prevTime","dist","timeElapsed","speedMps","speedKph","playAlert","error","code","TIMEOUT","console","warn","enableHighAccuracy","maximumAge","timeout","play","pause","className","children","onClick","ref","src","preload"],"sources":["C:/Users/User/Documents/GitHub/diploma-application/my-app/src/components/Dashboard/Speedometer.jsx"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\r\nimport '../../styles/MainPage/Speedometer.css';\r\n\r\nconst Speedometer = () => {\r\n  const [speed, setSpeed] = useState(0); \r\n  const [unit, setUnit] = useState('kph');\r\n  const watchId = useRef(null);\r\n  const prevPos = useRef(null);\r\n  const audioRef = useRef(null);\r\n  const speedLimit = 60; \r\n  const isAlertPlaying = useRef(false);\r\n\r\n  const getSpeedInUnit = () => {\r\n    switch (unit) {\r\n      case 'mps':\r\n        return (speed / 3.6).toFixed(2); // km/h -> m/s\r\n      case 'mph':\r\n        return (speed * 0.621371).toFixed(2); // km/h -> mph\r\n      default:\r\n        return speed.toFixed(2);\r\n    }\r\n  };\r\n\r\n  const changeUnit = (newUnit) => {\r\n    setUnit(newUnit);\r\n  };\r\n\r\n  const calculateDistance = (lat1, lon1, lat2, lon2) => {\r\n    const toRad = (val) => (val * Math.PI) / 180;\r\n    const R = 6371000; \r\n    const dLat = toRad(lat2 - lat1);\r\n    const dLon = toRad(lon2 - lon1);\r\n    const a =\r\n      Math.sin(dLat / 2) ** 2 +\r\n      Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) * Math.sin(dLon / 2) ** 2;\r\n    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\r\n    return R * c; \r\n  };\r\n\r\n  const startTracking = () => {\r\n    if (!navigator.geolocation) {\r\n      alert('Geolocation is not supported by your browser');\r\n      return;\r\n    }\r\n\r\n    if (watchId.current !== null) {\r\n      navigator.geolocation.clearWatch(watchId.current);\r\n      watchId.current = null;\r\n      setSpeed(0);\r\n      prevPos.current = null;\r\n      stopAlert();\r\n      return;\r\n    }\r\n\r\n    watchId.current = navigator.geolocation.watchPosition(\r\n      (position) => {\r\n        const { latitude, longitude } = position.coords;\r\n        const currentTime = position.timestamp;\r\n\r\n        if (prevPos.current) {\r\n          const { latitude: prevLat, longitude: prevLon, time: prevTime } = prevPos.current;\r\n\r\n          const dist = calculateDistance(prevLat, prevLon, latitude, longitude); \r\n          const timeElapsed = (currentTime - prevTime) / 1000; \r\n          if (timeElapsed > 0) {\r\n            const speedMps = dist / timeElapsed; \r\n            const speedKph = speedMps * 3.6; \r\n            setSpeed(speedKph);\r\n\r\n            if (speedKph > speedLimit) {\r\n              playAlert();\r\n            } else {\r\n              stopAlert();\r\n            }\r\n          }\r\n        }\r\n\r\n        prevPos.current = { latitude, longitude, time: currentTime };\r\n      },\r\n      (error) => {\r\n        if (error.code === error.TIMEOUT) {\r\n          console.warn('Geolocation timeout - position did not change');\r\n          return;\r\n        }\r\n        console.error('Error getting position:', error);\r\n        alert('Ошибка получения геолокации');\r\n      },\r\n      { enableHighAccuracy: true, maximumAge: 0, timeout: 3000 }\r\n    );\r\n  };\r\n\r\n  const playAlert = () => {\r\n    if (!isAlertPlaying.current && audioRef.current) {\r\n      audioRef.current.play();\r\n      isAlertPlaying.current = true;\r\n    }\r\n  };\r\n\r\n  const stopAlert = () => {\r\n    if (isAlertPlaying.current && audioRef.current) {\r\n      audioRef.current.pause();\r\n      audioRef.current.currentTime = 0;\r\n      isAlertPlaying.current = false;\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    return () => {\r\n      if (watchId.current !== null) {\r\n        navigator.geolocation.clearWatch(watchId.current);\r\n      }\r\n      stopAlert();\r\n    };\r\n  }, []);\r\n\r\n  return (\r\n    <div className=\"app-container\">\r\n      <main className=\"content\">\r\n        <div className=\"speedometer-section\">\r\n          <div className=\"speedometer-container\">\r\n            <div className=\"speedometer-unit-wrapper\">\r\n              <div className=\"speedometer-display\">\r\n                <div className=\"digital-speedometer\">\r\n                  <p>\r\n                    {getSpeedInUnit()} {unit}\r\n                  </p>\r\n                </div>\r\n              </div>\r\n              <aside className=\"unit-selector\">\r\n                <button onClick={() => changeUnit('mps')}>m/s</button>\r\n                <button onClick={() => changeUnit('mph')}>mph</button>\r\n                <button onClick={() => changeUnit('kph')}>km/h</button>\r\n              </aside>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"speed-controls\">\r\n            <button className=\"start-button\" onClick={startTracking}>\r\n              {watchId.current === null ? 'Start' : 'Stop'}\r\n            </button>\r\n          </div>\r\n\r\n          {/* Аудио с простым beep сигналом */}\r\n          <audio\r\n            ref={audioRef}\r\n            src=\"https://actions.google.com/sounds/v1/alarms/beep_short.ogg\"\r\n            preload=\"auto\"\r\n          />\r\n        </div>\r\n      </main>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Speedometer;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}